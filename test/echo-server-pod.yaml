apiVersion: v1
kind: Pod
metadata:
  name: echo-server
  labels:
    app: echo-server
spec:
  containers:
  - name: server
    image: python:3.12-slim
    ports:
    - containerPort: 8080
    command: ["python", "-u", "-c"]
    args:
      - |
        from http.server import BaseHTTPRequestHandler, HTTPServer

        class Handler(BaseHTTPRequestHandler):
            def _reply(self):
                self.send_response(200)
                self.send_header("Content-Type", "application/json")
                self.end_headers()
                self.wfile.write(
                    f'{{"method":"{self.command}","path":"{self.path}"}}'.encode()
                )

            do_GET = do_POST = do_PUT = do_DELETE = do_PATCH = do_OPTIONS = do_HEAD = _reply

        HTTPServer(("0.0.0.0", 8080), Handler).serve_forever()
